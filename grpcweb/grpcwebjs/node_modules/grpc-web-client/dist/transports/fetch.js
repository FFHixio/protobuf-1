"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var browser_headers_1 = require("browser-headers");
var debug_1 = require("../debug");
function fetchRequest(options) {
    options.debug && debug_1.debug("fetchRequest", options);
    function pump(reader, res) {
        return reader.read()
            .then(function (result) {
            if (result.done) {
                options.onEnd();
                return;
            }
            options.onChunk(result.value);
            return pump(reader, res);
        });
    }
    fetch(options.url, {
        headers: options.headers.toHeaders(),
        method: "POST",
        body: options.body,
    }).then(function (res) {
        options.debug && debug_1.debug("fetchRequest.response", res);
        options.onHeaders(new browser_headers_1.BrowserHeaders(res.headers), res.status);
        if (res.body) {
            return pump(res.body.getReader(), res);
        }
        return res;
    }).catch(function (err) {
        options.debug && debug_1.debug("fetchRequest.catch", err.message);
        options.onEnd(err);
    });
}
exports.default = fetchRequest;
//# sourceMappingURL=fetch.js.map